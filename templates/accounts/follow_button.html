<!-- templates/accounts/follow_button.html -->

{% if target_user_id and not is_self %}
<div class="follow-button-wrapper" data-user-id="{{ target_user_id }}">
  
  {% if is_authenticated %}
    <!-- Logged in user -->
    <form class="follow-form" 
          action="{% url 'toggle_follow' target_user_id %}" 
          method="POST"
          data-user-id="{{ target_user_id }}">
      {% csrf_token %}
      
      <button type="submit" 
              class="follow-btn follow-btn--{{ size }} follow-btn--{{ variant }}{% if is_following %} is-following{% endif %}"
              data-following="{{ is_following|yesno:'true,false' }}"
              data-user-id="{{ target_user_id }}">
        
        {% if is_following %}
          <!-- Currently Following -->
          <svg class="follow-btn__icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <polyline points="16 11 18 13 22 9"/>
          </svg>
          <span class="follow-btn__text">Following</span>
        {% else %}
          <!-- Not Following -->
          <svg class="follow-btn__icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <line x1="19" y1="8" x2="19" y2="14"/>
            <line x1="22" y1="11" x2="16" y2="11"/>
          </svg>
          <span class="follow-btn__text">Follow</span>
        {% endif %}
      </button>
    </form>
    
    {% if show_count %}
      <span class="follow-count">
        <span class="follow-count__number">{{ follower_count }}</span>
        <span class="follow-count__label">{% if follower_count == 1 %}follower{% else %}followers{% endif %}</span>
      </span>
    {% endif %}
    
  {% else %}
    <!-- Not logged in - redirect to login -->
    <a href="{% url 'login' %}?next={{ request.path }}" 
       class="follow-btn follow-btn--{{ size }} follow-btn--{{ variant }}">
      <svg class="follow-btn__icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <line x1="19" y1="8" x2="19" y2="14"/>
        <line x1="22" y1="11" x2="16" y2="11"/>
      </svg>
      <span class="follow-btn__text">Follow</span>
    </a>
    
    {% if show_count %}
      <span class="follow-count">
        <span class="follow-count__number">{{ follower_count }}</span>
        <span class="follow-count__label">{% if follower_count == 1 %}follower{% else %}followers{% endif %}</span>
      </span>
    {% endif %}
  {% endif %}
  
</div>
{% endif %}

{% if is_self %}
  <!-- User's own profile - optional edit button -->
  <div class="follow-button-wrapper follow-button-wrapper--self">
    <span class="follow-btn follow-btn--{{ size }} follow-btn--disabled">
      <span class="follow-btn__text"> </span>
    </span>
  </div>
{% endif %}