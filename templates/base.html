{% load static %} 
{% load widget_tweaks %}
{% load humanize %}
{% load profile_tags %}
{% load post_filters %}
{% load time_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}You - Buy, Sell, Seek and find{% endblock title %}</title>
    
    <!-- Preconnect to CDNs for faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Bootstrap 5.3.5 (Keep for grid, forms, modals) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    
    <!-- tailswind -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Font Awesome 6.x (Latest) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    
    <!-- lineicons  -->
    <link href="https://cdn.lineicons.com/5.0/lineicons.css" rel="stylesheet">    
    
    <!-- HTMX (Keep for dynamic updates if needed) -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Custom CSS Design System (Apple-inspired + X-refined - overrides Bootstrap) -->
    <link rel="stylesheet" href="{% static 'glocalization_app/css/00-bootstrap-overrides.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/01-variables.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/02-typography.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/03-layout.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/04-components.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/05-utilities.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/06-animations.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/overflow-handler.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/08-mobile-override.css' %}">
    <link rel="stylesheet" href="{% static 'glocalization_app/css/media-carousel.css' %}">
    <!-- Additional head content -->
    {% block extra_head %}{% endblock extra_head %}
</head>
<body class="container-fluid site-body {% block body_class %}{% endblock body_class %}">
    <!-- Skip to main content (Accessibility) -->
    <!-- <a href="#main-content" class="skip-link">Skip to main content</a> -->

    <!-- Sticky Header (Apple-inspired frosted glass) -->
    <header class="site-header" id="mainHeader">
        <div class="header-container">
            <!-- Logo -->
            <!-- <a href="/" class="site-logo"></a> -->
            <div class="function-key-toggle-notification" id="showSideBar" title="Toggle Notifications Sidebar Show">
                <span class="">
                    {% include "icons/icon-sidebar-open.html" %}
                </span>
            </div>
            <!-- Desktop Navigation -->
            <nav class="header-nav" title="Main navigation">
                {% block site-header-content %}
                {% if user.is_authenticated %}
                    
                {% else %}
                    <a href="{% url 'signup' %}" class="nav-link">Sign Up</a>
                    <a href="{% url 'login' %}" class="nav-link">Login</a>
                {% endif %}
                {% endblock site-header-content %}
            </nav>
            
            <!-- User Actions -->
            {% if user.is_authenticated %}
            <div class="header-actions">
              
            </div>
            {% endif %}
        </div>
        
        <!-- Mobile Menu (Hidden by default) -->
        <div class="mobile-menu" id="mobileMenu">
            {% if user.is_authenticated %}
                <a href="/" class="mobile-menu-item">Home</a>
                <a href="{% url 'seekers:seeker_list' %}" class="mobile-menu-item">Seekers</a>
                <a href="{% url 'board:unified_board' %}" class="mobile-menu-item">Board</a>
                <a href="{% url 'notifications:notifications-page' %}" class="mobile-menu-item">Activity</a>
                <a href="{% url 'person_detail' user.pk %}" class="mobile-menu-item">Profile</a>
                <a href="{% url 'subscription:plans' %}" class="mobile-menu-item">Upgrade</a>
                <a href="{% url 'logout' %}" class="mobile-menu-item">Logout</a>
                <a href="{% url 'delete_account' %}" class="mobile-menu-item mobile-menu-danger">Delete Account</a>
            {% else %}
                <a href="{% url 'signup' %}" class="mobile-menu-item">Sign Up</a>
                <a href="{% url 'login' %}" class="mobile-menu-item">Login</a>
            {% endif %}
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="main-content" class="main-container">
        <!-- Messages/Alerts (Django messages) -->
        {% block messages %}
            {% if messages %}
                <div class="messages-container">
                    {% for message in messages %}
                        <div class="toast toast-{{ message.tags }}" role="alert" aria-live="polite">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endblock messages %}
      
        
<div class="platform-wrapper" id="platformWrapper">
    <!-- LEFT SIDEBAR -->
    <aside class="platform-sidebar" id="platformSidebar">
        <div class="sidebar-container container-fluid">
            <div class="function-key-toggle-notification" id="hideSideBar" title="Toggle Notifications Sidebar Hide">
                <span>
                    {% include 'icons/icon-sidebar-close.html' %}
                </span>
            </div>
            <!-- User Info (if authenticated) -->
            <!-- Navigation -->
            <nav class="sidebar-nav">            
                {% if user.is_authenticated %}         
                <a href="{% url 'postfinder_search' %}" class="sidebar-nav-item" data-tooltip="Home Feed" title="Search">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/icon-searchbar.html' %}
                    <span>Search</span>
                    </div>
                </a>
               
                <a href="{% url 'logout' %}" class="sidebar-nav-item" data-tooltip="logout" title="Logout">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/icon-logout.html' %}
                    <span>Logout</span>
                    </div>
                </a>
               
                <a href="{% url 'notifications:notifications-page' %}" class="sidebar-nav-item" data-tooltip="Notifications" title="Notification">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/notification.html' %}
                    <span>Activity</span>
                    {% comment %}
                    <!-- Add notification count if available -->
                    <span class="sidebar-nav-badge">3</span>
                    {% endcomment %}
                    </div>
                </a>
                <a href="{% url 'person_list' %}" class="sidebar-nav-item" data-tooltip="Community" title="Around us">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/store.html' %}
                    <span>Community</span>
                    </div>
                </a>
                <a href="{% url 'post_home' %}" class="sidebar-nav-item" data-tooltip="Community" arial-label="Home">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/icon-home.html' %}
                    <span>Home</span>
                    </div>
                </a>
                <a href="{% url 'my_pending_posts' %}" class="sidebar-nav-item" data-tooltip="My posts" arial-label="My posts">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/draft.html' %}
                    <span>Drafts</span>
                    </div>
                </a>
    
                <a href="{% url 'subscription:plans' %}" class="sidebar-nav-item" data-tooltip="Upgrade" title="Upgrade">
                    <div class="sidebar-nav-item-container">
                    {% include 'icons/crown.html' %}                    
                    <span>Upgrade</span>
                    </div>
                </a>
                <a href="{% url 'person_detail' user.pk %}" class="sidebar-nav-item" alt="Profile Picture {{ user.username }}" title="Account">
                    <div class="sidebar-nav-item-container">
                    {% include "icons/icon-profile.html" %}
                    <span>Profile</span>
                    </div>
                </a>

                <!-- Create Post Button -->
                <!-- <div class="sidebar-cta">
                    <a href="{% url 'post_create' %}" class="btn-create-post">
                        <i class="fas fa-plus"></i> Create New Post
                    </a>
                </div> -->
                {% else %}
                <a href="{% url 'login' %}" class="sidebar-nav-item" title="Login">
                    <div class="sidebar-nav-item-container">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login</span>
                    </div>
                </a>
                
                <a href="{% url 'signup' %}" class="sidebar-nav-item" title="Sign up">
                    <div class="sidebar-nav-item-container">
                    <i class="fas fa-user-plus"></i>
                    <span>Sign Up</span>
                    </div>
                </a>
                {% endif %}
                <!-- <div class="text-muted small mt-4 footer-texts">
                    <a href="#" class="text-muted me-2">About</a>
                    <a href="#" class="text-muted me-2">Terms</a>
                    <a href="#" class="text-muted me-2">Privacy</a>
                    <a href="#" class="text-muted">Help</a>
                    <div class="mt-2">© 2025 TradesApp</div>
                </div> -->
            </nav>
        </div>
    </aside>

        {% block content %}{% endblock content %}
        {% block bottom_navigation %}{% endblock bottom_navigation %}
        <!-- RIGHT WIDGETS -->
<aside class="platform-widgets">
    <!-- Public Board Widget -->
<div class="widget-card container-fluid" id="public-board-widget">
    <div class="widget-header">
        <span class="badge bg-danger ms-2 live-badge">
            <span class="live-dot"></span>
            Recent
        </span>
        <a href="{% url 'board:unified_board' %}" title="See all latest" class="widget-header-action" title="View All Posts">
            {% include 'icons/icon-more.html' %}
        </a>
    </div>

    <div class="widget-body">
        {% if board_items %}
            {% for item in board_items %}
                {% if item.obj %}
                    {% if item.type == "post" %}
                        <!-- Post from board -->
                        <a href="{% url 'post_detail' item.obj.id %}" class="widget-item widget-item-link">
                            <div class="widget-item-content">
                                <div class="widget-item-main">
                                    <span class="widget-item-title" data-marquee="true">
                                        <!-- <i class="fas fa-shopping-cart text-primary"></i> -->
                                        {{ item.obj.product_name|truncatewords:3 }} &nbsp; • {{ item.obj.created_at|short_time }}
                                    </span>
                                    <small class="widget-item-meta text-muted">
                                        {{ item.obj.description }}
                                    </small>
                                </div>
                            </div>
                        </a>

                    {% elif item.type == "seekerpost" %}
                        <!-- Seeker post from board -->
                        <a href="{% url 'seekers:seeker_detail' item.obj.id %}" class="widget-item widget-item-link">
                            <div class="widget-item-content">
                                <div class="widget-item-main">
                                    <span class="widget-item-title" data-marquee="true">
                                        <!-- <i class="fas fa-search text-warning"></i> -->
                                        {{ item.obj.seeker_product_name|default:item.obj.title|truncatewords:3 }} &nbsp; • {{ item.obj.created_at|short_time }}
                                    </span>
                                    <small class="widget-item-meta text-muted">
                                        {{ item.obj.description }}
                                    </small>
                                </div>
                            </div>
                        </a>
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% else %}
            <style>
                .platform-widgets{
                    display: none;
                }
            </style>
        {% endif %}
    </div>

    <!-- Show More Button -->
</div>
{% block widget %}{% endblock widget %}
    </aside>
        <!-- adding some jump to top feature that refreshes the page in case new posts were added before user completely scrolled down the end of page -->
    </main>

    <!-- Mobile Bottom Navigation (Show only on mobile when authenticated) -->
    <!-- {% if user.is_authenticated %} -->

    <!-- {% endif %} -->
  

    <!-- Additional scripts -->
    {% block extra_scripts %}{% endblock extra_scripts %}

    <!-- Custom UI JavaScript (NEW features only)
    <script src="{% static 'js/frontend/main.js' %}"></script>
    <script src="{% static 'js/frontend/search-engine.js' %}"></script>
    <script src="{% static 'js/frontend/responsive-handler.js' %}"></script>
    <script src="{% static 'js/frontend/performance.js' %}"></script>
    <script src="{% static 'js/frontend/forms.js' %}"></script>
    <script src="{% static 'js/frontend/interactions.js' %}"></script> -->

    <!-- Enhanced Frontend JavaScript (Load AFTER existing scripts) -->
    <script src="{% static 'js/01-frontend/main.js' %}"></script>
    <script src="{% static 'js/01-frontend/responsive-handler.js' %}"></script>
    <script src="{% static 'js/01-frontend/performance.js' %}"></script>
    <script src="{% static 'js/01-frontend/interactions.js' %}"></script>
    <!-- Add the new overflow handler -->
    <script src="{% static 'js/01-frontend/smart-overflow-handler.js' %}"></script>
    <script src="{% static 'js/01-frontend/text-length-handler.js' %}"></script>
    <script src="{% static 'js/01-frontend/sidebar-handler.js' %}"></script>
    <script src="{% static 'js/01-frontend/header.js' %}"></script>
    <script src="{% static 'js/01-frontend/media_carousel.js' %}"></script>
    <script src="{% static 'js/01-frontend/header-smooth-move.js' %}"></script>
    <script src="{% static 'js/01-frontend/back_button.js' %}"></script>
    <script src="{% static 'js/01-frontend/image-dominant-bg.js' %}"></script>
    <!-- <script src="{% static 'js/01-frontend/widget-marquee.js' %}"></script> -->

    <!-- Core JavaScript -->
    <!-- Bootstrap JS (Keep for modals, dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    
</body>

</html>