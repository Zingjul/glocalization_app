{% extends "base.html" %}
{% load crispy_forms_tags %}  <!-- ðŸ”¥ Load Crispy Forms -->
{% load static %}
<script src="{% static 'search/location_autocomplete.js' %}"></script>

{% block content %}
<h2>Create a New Post</h2>

{% if not user.profile.continent or not user.profile.country or not user.profile.state or not user.profile.town or not user.profile.business_name %}
    <div class="alert alert-warning">
        <strong>Warning:</strong> Your profile is incomplete!  
        Please <a href="{% url 'person_edit' user.profile.pk %}" class="alert-link">complete your profile</a> before posting a product.
    </div>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    {{ form.category|as_crispy_field }}
    {{ form.product_name|as_crispy_field }}
    {{ form.description|as_crispy_field }}
    {{ form.author_phone_number|as_crispy_field }}
    {{ form.author_email|as_crispy_field }}

    <!-- ðŸ”¥ Location Selection -->
    <div class="mb-3">
        <label>{{ form.use_default_location.label }}</label>
        {{ form.use_default_location }}
    </div>

    <!-- ðŸ”¥ Location Fields (Selection + Input) -->
    <div id="location_fields" style="display: none;">
        <div class="mb-3">
            <label for="continent">Continent</label>
            {{ form.continent }}
            <input type="text" id="continent_text" name="continent_text" class="form-control location-input" placeholder="Type a continent">
        </div>

        <div class="mb-3">
            <label for="country">Country</label>
            {{ form.country }}
            <input type="text" id="country_text" name="country_text" class="form-control location-input" placeholder="Type a country">
        </div>

        <div class="mb-3">
            <label for="state">State</label>
            {{ form.state }}
            <input type="text" id="state_text" name="state_text" class="form-control location-input" placeholder="Type a state">
        </div>

        <div class="mb-3">
            <label for="town">Town</label>
            {{ form.town }}
            <input type="text" id="