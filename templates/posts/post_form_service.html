{% extends "base.html" %}

{% block content %}
  <h2 class="text-xl font-semibold mb-4">Create Service Post</h2>

  <form method="post" enctype="multipart/form-data" id="postForm">
    {% csrf_token %}
    
    <!-- ðŸ”½ Render each field manually (excluding image1â€“image6) -->
    <div>{{ form.product_name.label_tag }} {{ form.product_name }}</div>
    <div>{{ form.description.label_tag }} {{ form.description }}</div>
    <div>{{ form.author_phone_number.label_tag }} {{ form.author_phone_number }}</div>
    <div>{{ form.author_email.label_tag }} {{ form.author_email }}</div>
    <div>{{ form.service_details.label_tag }} {{ form.service_details }}</div>
    <div>{{ form.qualifications.label_tag }} {{ form.qualifications }}</div>
    <div>{{ form.availability_schedule.label_tag }} {{ form.availability_schedule }}</div>
    <div>{{ form.service_guarantees.label_tag }} {{ form.service_guarantees }}</div>

    <div>
      {{ form.availability_scope.label_tag }}
      {{ form.availability_scope }}
    </div>
    
    <!-- Location Fields (optional customization) -->
    <div>{{ form.post_continent.label_tag }} {{ form.post_continent }}</div>
    <div>{{ form.post_country.label_tag }} {{ form.post_country }}</div>
    <div>{{ form.post_state.label_tag }} {{ form.post_state }}</div>
    <div>{{ form.post_town.label_tag }} {{ form.post_town }}</div>

    <!-- Manual image fields -->
    <label for="image1">Image 1:</label><input type="file" name="image1"><br>
    <label for="image2">Image 2:</label><input type="file" name="image2"><br>
    <label for="image3">Image 3:</label><input type="file" name="image3"><br>
    <label for="image4">Image 4:</label><input type="file" name="image4"><br>
    <label for="image5">Image 5:</label><input type="file" name="image5"><br>
    <label for="image6">Image 6:</label><input type="file" name="image6"><br>

    <!-- Preview container -->
    <div id="imagePreviewContainer" class="flex flex-wrap gap-3 mt-4 mb-6"></div>

    <!-- Social Media Form -->
    <h3 class="text-lg font-semibold mt-6 mb-2">Social Media Handles</h3>
    {{ social_form.as_p }}

    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
      Submit
    </button>
  </form>

  <!-- âœ… JavaScript for previewing images -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const previewContainer = document.getElementById("imagePreviewContainer");

      for (let i = 1; i <= 6; i++) {
        const input = document.querySelector(`input[name="image${i}"]`);
        if (input) {
          input.addEventListener("change", (event) => {
            const file = event.target.files[0];
            const previewId = `preview-image${i}`;

            // Remove previous preview
            const existing = document.getElementById(previewId);
            if (existing) existing.remove();

            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                const img = document.createElement("img");
                img.id = previewId;
                img.src = e.target.result;
                img.className = "w-28 h-28 object-cover rounded shadow border";
                previewContainer.appendChild(img);
              };
              reader.readAsDataURL(file);
            }
          });
        }
      }
    });
  </script>
{% endblock %}
