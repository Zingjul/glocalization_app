{# Generic media carousel - works with any object that has media_files #}
{# Usage: {% include 'media_app/media_carousel.html' with media_files=object.media_files.all object_id=object.pk %} #}

<div class="current-images__container">
  {% if media_files.count > 0 %}
    <div class="media-carousel" data-post-id="{{ object_id }}">
      <div class="media-carousel__container">

        <!-- Track containing all media items -->
        <div class="media-carousel__track">
          {% for media in media_files %}
            <div class="media-carousel__item {% if forloop.first %}active{% endif %}"
                 data-index="{{ forloop.counter0 }}">

              {% if media.file_type == "image" %}
                <img src="{{ media.file.url }}"
                     alt="{{ media.caption|default:'Media' }} {{ forloop.counter }}"
                     loading="lazy"
                     class="media-carousel__image"
                     onerror="this.style.display='none'; this.closest('.media-carousel__item').innerHTML='<p class=\'text-red-500 p-4\'>Image failed to load.</p>'">
                
                <!-- Caption overlay (appears on hover) - Images only -->
                {% if media.caption %}
                <div class="media-carousel__caption">
                  <span class="media-carousel__caption-text">{{ media.caption }}</span>
                </div>
                {% endif %}
              
              {% elif media.file_type == "video" %}
                <video class="media-carousel__video" controls preload="metadata"
                       onclick="event.stopPropagation();">
                  <source src="{{ media.file.url }}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
                
                <!-- Caption for videos (always visible below video) -->
                {% if media.caption %}
                <div class="media-carousel__caption media-carousel__caption--video">
                  <span class="media-carousel__caption-text">{{ media.caption }}</span>
                </div>
                {% endif %}
              {% endif %}
              
            </div>
          {% endfor %}
        </div>

        {% if media_files.count > 1 %}
          <!-- Navigation Buttons -->
          <button class="media-carousel__nav media-carousel__nav--prev"
                  onclick="navigateMedia(this, 'prev')"
                  aria-label="Previous Media">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="media-carousel__nav media-carousel__nav--next"
                  onclick="navigateMedia(this, 'next')"
                  aria-label="Next Media">
            <i class="fas fa-chevron-right"></i>
          </button>

          <!-- Indicators -->
          <div class="media-carousel__indicators">
            {% for media in media_files %}
              <div class="media-carousel__indicator {% if forloop.first %}active{% endif %}"
                   onclick="goToMedia('{{ object_id }}', '{{ forloop.counter0 }}')"
                   aria-label="Go to media item {{ forloop.counter }}">
              </div>
            {% endfor %}
          </div>

          <!-- Counter -->
          <div class="media-carousel__counter">
            {{ media_files.count }}
          </div>
        {% endif %}

      </div>
    </div>
  {% else %}
    <!-- <div class="media-carousel__item active flex items-center justify-center h-full">
      <p class="text-gray-500 p-4">No media uploaded.</p>
    </div> -->
  {% endif %}
</div>